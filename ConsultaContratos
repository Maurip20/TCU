let
    Fonte = SharePoint.Files("https://sescsp.sharepoint.com/sites/MCI-MonitoramentoeControledeIndicadores/", [ApiVersion = 15]),
    #"Linhas Filtradas" = Table.SelectRows(Fonte, each [Folder Path] = CaminhoArquivo),
    #"2022_CONTRATOS xlsx_https://sescsp sharepoint com/sites/MCI-MonitoramentoeControledeIndicadores/Shared Documents/TCU/" = #"Linhas Filtradas"{[Name="2022_CONTRATOS.xlsx",#"Folder Path"="https://sescsp.sharepoint.com/sites/MCI-MonitoramentoeControledeIndicadores/Shared Documents/TCU/"]}[Content],
    #"Pasta de Trabalho Importada do Excel" = Excel.Workbook(#"2022_CONTRATOS xlsx_https://sescsp sharepoint com/sites/MCI-MonitoramentoeControledeIndicadores/Shared Documents/TCU/"),
    #"2022_CONTRATOS_Sheet" = #"Pasta de Trabalho Importada do Excel"{[Item="2022_CONTRATOS",Kind="Sheet"]}[Data],
    #"Cabeçalhos Promovidos" = Table.PromoteHeaders(#"2022_CONTRATOS_Sheet", [PromoteAllScalars=true]),
    #"Tipo Alterado" = Table.TransformColumnTypes(#"Cabeçalhos Promovidos",{{"ANO_EDITAL", Int64.Type}, {"EDITAL", type text}, {"CONTRATO", Int64.Type}, {"COMPARTILHADA", Int64.Type}, {"OBS_COMPARTILHADA", type any}, {"DT_EDITAL", type text}, {"PROCESSO", type any}, {"MOD_LICITACAO", Int64.Type}, {"REG_PRECOS", Int64.Type}, {"NAT_OBJETO", Int64.Type}, {"DESC_OBJETO", type text}, {"CAT_OBJETO", Int64.Type}, {"CRIT_JULGAMENTO", Int64.Type}, {"DT_HOMOLOGACAO", type date}, {"NOME_CONTRATADA", type text}, {"CNPJ", Int64.Type}, {"CPF", Int64.Type}, {"DT_CONTRATO", type date}, {" VL_CONTRATO ", type number}, {"VIGENCIA", Int64.Type}, {"ADITIVO_PRECO", Int64.Type}, {" VL_ADITIVO_PRECO", type number}, {"ADITIVO_PRAZO", Int64.Type}, {"VL_ADITIVO_PRAZO", Int64.Type}, {"ADITIVO_OBJETO", Int64.Type}, {" VL_REF_OBRA ", type any}, {"FASE_OBRA", Int64.Type}, {"EXEC_FISICA_OBRA", type number}, {"GRAT_OBRA", Int64.Type}, {"OBS", type text}}),
    #"Tipo Alterado1" = Table.TransformColumnTypes(#"Tipo Alterado",{{"ANO_EDITAL", type text}}),
    #"Personalização Adicionada" = Table.AddColumn(#"Tipo Alterado1", "ANO_EDITAL_COR", each if Text.Length([ANO_EDITAL]) <> 4 then "CORRIGIR" else "OK"),
    #"Personalização Adicionada8" = Table.AddColumn(#"Personalização Adicionada", "EDITAL_COR", each if Text.AfterDelimiter([EDITAL],"/") = [ANO_EDITAL] then "OK" else if Text.Start(Text.AfterDelimiter([EDITAL], " "),4) = [ANO_EDITAL] then "OK" else if  Text.Contains(Text.Start([EDITAL], 6), Text.From([ANO_EDITAL])) = Logical.FromText("true") then "OK" else "CORRIGIR"),
    #"Personalização Adicionada1" = Table.AddColumn(#"Personalização Adicionada8", "COMPARTILHADA_COR", each if([COMPARTILHADA] = 1 or [COMPARTILHADA] = 2 or  [COMPARTILHADA] = 3 or [COMPARTILHADA] = 4) then "OK" else "CORRIGIR"),
    #"Personalização Adicionada2" = Table.AddColumn(#"Personalização Adicionada1", "DT_EDITAL_COR", each if Text.Length(Text.AfterDelimiter([DT_EDITAL],"/",1)) > 4 then "CORRIGIR_ANO" else if Date.Day(Date.From([DT_EDITAL])) > 31 then "CORRIGIR_DIA" else if Date.Month(Date.From([DT_EDITAL])) > 12 then "CORRIGIR_MES" else 
if Date.Year(Date.From([DT_EDITAL])) = Date.Year(Date.From([ANO_EDITAL])) then "OK" else "CORRIGIR_ANO"),
    #"Personalização Adicionada3" = Table.AddColumn(#"Personalização Adicionada2", "MOD_LICITACAO_COR", each if [MOD_LICITACAO] = 1 or [MOD_LICITACAO] = 2 or [MOD_LICITACAO] = 3 or [MOD_LICITACAO] = 4 or [MOD_LICITACAO] = 5 or [MOD_LICITACAO] = 6 or [MOD_LICITACAO] = 7 or [MOD_LICITACAO] = 8 or [MOD_LICITACAO] = 9 or [MOD_LICITACAO] = 10 then "OK" else "CORRIGIR"),
    #"Personalização Adicionada4" = Table.AddColumn(#"Personalização Adicionada3", "REG_PRECOS_COR", each if [REG_PRECOS] = 1 or [REG_PRECOS] = 2  then "OK" else if [REG_PRECOS] = 1 and [MOD_LICITACAO] = 1 then "OK1" else if [REG_PRECOS] = 1 and [MOD_LICITACAO] = 2 then "OK2" else "CORRIGIR"),
    #"Personalização Adicionada5" = Table.AddColumn(#"Personalização Adicionada4", "NAT_OBJETO_COR", each if [NAT_OBJETO] = 1 or [NAT_OBJETO] = 2 or [NAT_OBJETO] = 3 or [NAT_OBJETO] = 4 or [NAT_OBJETO] = 5 then "OK" else "CORRIGIR"),
    #"Personalização Adicionada6" = Table.AddColumn(#"Personalização Adicionada5", "CAT_OBJETO_COR", each if [CAT_OBJETO] = 1 then "OK - OBS" else if [CAT_OBJETO] = 2 then "OK" else if [CAT_OBJETO] = 3 then "OK" else if [CAT_OBJETO] = 4 then "OK" else if [CAT_OBJETO] = 5 then "OK" else if [CAT_OBJETO] = 6 then "OK" else if [CAT_OBJETO] = 7 then "OK" else if [CAT_OBJETO] = 8 then "OK" else if [CAT_OBJETO] = 9 then "OK" else if [CAT_OBJETO] = 10 then "OK" else if [CAT_OBJETO] = 11 then "OK" else if [CAT_OBJETO] = 12 then "OK" else if [CAT_OBJETO] = 13 then "OK" else if [CAT_OBJETO] = 14 then "OK" else if [CAT_OBJETO] = 15 then "OK" else if [CAT_OBJETO] = 16 then "OK" else if [CAT_OBJETO] = 17 then "OK" else if [CAT_OBJETO] = 18 then "OK" else if [CAT_OBJETO] = 19 then "OK" else if [CAT_OBJETO] = 20 then "OK" else if [CAT_OBJETO] = 21 then "OK" else if [CAT_OBJETO] = 22 then "OK" else if [CAT_OBJETO] = 23 then "OK" else if [CAT_OBJETO] = 24 then "OK" else if [CAT_OBJETO] = 25 then "OK" else if [CAT_OBJETO] = 26 then "OK" else if [CAT_OBJETO] = 27 then "OK" else if [CAT_OBJETO] = 28 then "OK" else if [CAT_OBJETO] = 29 then "OK" else if [CAT_OBJETO] = 30 then "OK" else if [CAT_OBJETO] = 31 then "OK" else if [CAT_OBJETO] = 32 then "OK" else if [CAT_OBJETO] = 33 then "OK" else if [CAT_OBJETO] = 34 then "OK" else if [CAT_OBJETO] = 35 then "OK" else if [CAT_OBJETO] = 36 then "OK" else if [CAT_OBJETO] = 37 then "OK" else if [CAT_OBJETO] = 38 then "OK" else if [CAT_OBJETO] = 39 then "OK" else if [CAT_OBJETO] = 40 then "OK - OBS" else "CORRIGIR"),
    #"Personalização Adicionada7" = Table.AddColumn(#"Personalização Adicionada6", "CRIT_JULGAMENTO_COR", each if [CRIT_JULGAMENTO] = 1 or [CRIT_JULGAMENTO] = 2 or [CRIT_JULGAMENTO] = 3 or [CRIT_JULGAMENTO] = 4 or [CRIT_JULGAMENTO] = 5 then "OK" else "CORRIGR"),
    #"Tipo Alterado12" = Table.TransformColumnTypes(#"Personalização Adicionada7",{{"CNPJ", type text}, {"DT_HOMOLOGACAO", type text}, {"DT_CONTRATO", type text}}),
    #"Personalização Adicionada9" = Table.AddColumn(#"Tipo Alterado12", "DT_HOMOLOGACAO_COR", each if Text.Length(Text.AfterDelimiter([DT_HOMOLOGACAO],"/",1)) > 4 or Text.Length(Text.AfterDelimiter([DT_EDITAL],"/",1)) > 4 then "CORRIGIR_ANO" else if Date.Day(Date.From([DT_HOMOLOGACAO])) > 31 then "CORRIGIR_DIA" else if Date.Month(Date.From([DT_HOMOLOGACAO])) > 12 then "CORRIGIR_MES" else if Date.From([DT_CONTRATO]) < Date.From([DT_HOMOLOGACAO]) then "Data do Contrato anterior Data de Homologação" else if Date.From([DT_HOMOLOGACAO]) >= Date.From([DT_EDITAL]) then "OK" else "Data de Homologação anterior a Data do Edital"),
    #"Tipo Alterado2" = Table.TransformColumnTypes(#"Personalização Adicionada9",{{"CNPJ", type text}, {"CPF", type text}}),
    #"Valor Substituído6" = Table.ReplaceValue(#"Tipo Alterado2",null,"",Replacer.ReplaceValue,{"CPF"}),
    #"Valor Substituído" = Table.ReplaceValue(#"Valor Substituído6",null,"",Replacer.ReplaceValue,{"CNPJ"}),
    #"Personalização Adicionada10" = Table.AddColumn(#"Valor Substituído", "CNPJ_COR", each if Text.Contains([CNPJ], ".") or Text.Contains([CNPJ], "/")then "CORRIGIR" else "OK"),
    #"Personalização Adicionada11" = Table.AddColumn(#"Personalização Adicionada10", "CPF_COR", each if Text.Contains([CPF], ".") or Text.Contains([CPF], "/") or Text.Contains([CPF], "-") then "CORRIGIR" else "OK"),
    #"Personalização Adicionada12" = Table.AddColumn(#"Personalização Adicionada11", "DT_CONTRATO_COR", each if Date.Day(Date.From([DT_CONTRATO])) > 31 then "CORRIGIR_DIA" else if Date.Month(Date.From([DT_CONTRATO])) > 12 then "CORRIGIR_MES" else 
if Text.Length(Text.AfterDelimiter([DT_CONTRATO],"/",1)) > 4 then "CORRIGIR_ANO" else if Date.From([DT_CONTRATO]) >= Date.From([DT_HOMOLOGACAO]) then "OK" else "Data do Contrato anterior Data de Homologação"),
    #"Tipo Alterado3" = Table.TransformColumnTypes(#"Personalização Adicionada12",{{" VL_CONTRATO ", type text}}),
    #"Personalização Adicionada13" = Table.AddColumn(#"Tipo Alterado3", "VL_CONTRATO_R$DEC_COR", each if Text.Contains(([#" VL_CONTRATO "]), "R$") = Logical.FromText("true") then "CORRIGIR_R$" else 

if Text.Length(Text.AfterDelimiter(([#" VL_CONTRATO "]), ",")) >= 2 or Text.Length(Text.AfterDelimiter(([#" VL_CONTRATO "]), ",")) = 0 or Text.Length(Text.AfterDelimiter(([#" VL_CONTRATO "]), ",")) = 1 then "OK"  else "CORRIGIR_DEC"),
    #"Tipo Alterado4" = Table.TransformColumnTypes(#"Personalização Adicionada13",{{" VL_PAGO", type text}}),
    #"Personalização Adicionada15" = Table.AddColumn(#"Tipo Alterado4", "VL_PAGO_R$_COR", each if Text.Contains(([#" VL_PAGO"]), "R$") = Logical.FromText("true") then "CORRIGIR_R$" else 

if Text.Length(Text.AfterDelimiter(([#" VL_PAGO"]), ",")) >= 2 or Text.Length(Text.AfterDelimiter(([#" VL_PAGO"]), ",")) = 0 or Text.Length(Text.AfterDelimiter(([#" VL_PAGO"]), ",")) = 1  then "OK" else "CORRIGIR"),
    #"Personalização Adicionada17" = Table.AddColumn(#"Personalização Adicionada15", "ADITIVO_PRECO_COR", each if [ADITIVO_PRECO] = 1 or [ADITIVO_PRECO] = 2 then "OK" else "CORRIGIR"),
    #"Personalização Adicionada29" = Table.AddColumn(#"Personalização Adicionada17", "VL_ADITIVO_PRECO_COR", each if [ADITIVO_PRECO] = 1 and Text.Length(Number.ToText([#" VL_ADITIVO_PRECO"])) <= 0 then "CORRIGIR" else if [ADITIVO_PRECO] = 1 and Text.Length(Number.ToText([#" VL_ADITIVO_PRECO"])) = "0" then "CORRIGIR - VALOR ZERADO" else if [ADITIVO_PRECO] = 1 and [#" VL_ADITIVO_PRECO"] = [#" VL_CONTRATO "] then "CORRIGIR - ADITIVIO IGUAL CONTRATO" else "OK"),
    #"Personalização Adicionada18" = Table.AddColumn(#"Personalização Adicionada29", "VL_ADITIVO_PRECO__R$DEC_COR", each if Text.Contains((Number.ToText([#" VL_ADITIVO_PRECO"])), "R$") = Logical.FromText("true") then "CORRIGIR_R$" else 

if Text.Length(Text.AfterDelimiter((Number.ToText( [#" VL_ADITIVO_PRECO"])), ",")) >= 2 or Text.Length(Text.AfterDelimiter((Number.ToText( [#" VL_ADITIVO_PRECO"])), ",")) = 0 or Text.Length(Text.AfterDelimiter((Number.ToText( [#" VL_ADITIVO_PRECO"])), ",")) = 1 then "OK"  else "CORRIGIR_DEC"),
    #"Personalização Adicionada20" = Table.AddColumn(#"Personalização Adicionada18", "ADITIVO_PRAZO_COR", each if [ADITIVO_PRAZO] = 1 or [ADITIVO_PRAZO] = 2 then "OK" else "CORRIGIR"),
    #"Tipo Alterado6" = Table.TransformColumnTypes(#"Personalização Adicionada20",{{"VL_ADITIVO_PRAZO", type text}}),
    #"Valor Substituído1" = Table.ReplaceValue(#"Tipo Alterado6",null,"",Replacer.ReplaceValue,{"VL_ADITIVO_PRAZO"}),
    #"Personalização Adicionada21" = Table.AddColumn(#"Valor Substituído1", "VL_ADITIVO_PRAZO_COR", each if Text.Contains([VL_ADITIVO_PRAZO], ",") then "CORRIGIR" else if Text.Length([VL_ADITIVO_PRAZO]) > 0 and ([ADITIVO_PRAZO]) <> 1 then "CORRIGIR" else if [VL_ADITIVO_PRAZO] = [VIGENCIA] then "ADITIVO PRAZO IGUAL VIGENCIA" else if [ADITIVO_PRAZO] = 1 and [VL_ADITIVO_PRAZO] = 0
then "CORRIGIR3" else "OK"),
    #"Personalização Adicionada22" = Table.AddColumn(#"Personalização Adicionada21", "ADITIVO_OBJETO_COR", each if [ADITIVO_OBJETO] = 1 or [ADITIVO_OBJETO] = 2 then "OK" else "CORRIGIR"),
    #"Tipo Alterado7" = Table.TransformColumnTypes(#"Personalização Adicionada22",{{" VL_REF_OBRA ", type text}}),
    #"Valor Substituído2" = Table.ReplaceValue(#"Tipo Alterado7",null,"",Replacer.ReplaceValue,{" VL_REF_OBRA "}),
    #"Personalização Adicionada23" = Table.AddColumn(#"Valor Substituído2", "VL_REF_OBRA_R$DEC_COR", each if Text.Contains(([#" VL_REF_OBRA "]), "R$") = Logical.FromText("true") then "CORRIGIR_R$" else 

if Text.Length(Text.AfterDelimiter(([#" VL_REF_OBRA "]), ",")) <= 2 or Text.Length(Text.AfterDelimiter([#" VL_REF_OBRA "], ",")) = 0 then "OK"  else "CORRIGIR_DEC"),
    #"Personalização Adicionada24" = Table.AddColumn(#"Personalização Adicionada23", "VL_REF_OBRA_R$_COR", each if [NAT_OBJETO] = 1 and Text.Length([#" VL_REF_OBRA "]) <= 0 then "OBRA SEM VALOR DE REFERENCIA"  else "OK"),
    #"Tipo Alterado8" = Table.TransformColumnTypes(#"Personalização Adicionada24",{{"EXEC_FISICA_OBRA", type text}}),
    #"Valor Substituído3" = Table.ReplaceValue(#"Tipo Alterado8",null,"",Replacer.ReplaceValue,{"EXEC_FISICA_OBRA"}),
    #"Tipo Alterado9" = Table.TransformColumnTypes(#"Valor Substituído3",{{"FASE_OBRA", type text}}),
    #"Valor Substituído4" = Table.ReplaceValue(#"Tipo Alterado9",null,"",Replacer.ReplaceValue,{"FASE_OBRA"}),
    #"Personalização Adicionada25" = Table.AddColumn(#"Valor Substituído4", "FASE_OBRA_COR", each if [NAT_OBJETO] = 1 and Text.Length([FASE_OBRA]) <= 0 then "CORRIGIR" else if [NAT_OBJETO] = 2 and Text.Length([FASE_OBRA]) > 0 then "CORRIGIR" else if [NAT_OBJETO] = 3 and Text.Length([FASE_OBRA]) > 0 then "CORRIGIR" else if  [NAT_OBJETO] = 4 and Text.Length([FASE_OBRA]) > 0 then "CORRIGIR" else if [NAT_OBJETO] = 5 and Text.Length([FASE_OBRA]) > 0 then "CORRIGIR" else "OK"),
    #"Personalização Adicionada27" = Table.AddColumn(#"Personalização Adicionada25", "EXEC_FISICA_OBRA_COR", each if [NAT_OBJETO] = 1 then 
  (if Text.Length( [EXEC_FISICA_OBRA]) > 5 then "CORRIGIR" 
else if Text.Length([EXEC_FISICA_OBRA]) = 0 then "VALOR NULO"  else "OK") 
   else if Text.Length([EXEC_FISICA_OBRA]) = 0 then "OK" else "CORRIGIR"),
    #"Tipo Alterado10" = Table.TransformColumnTypes(#"Personalização Adicionada27",{{"GRAT_OBRA", type text}}),
    #"Valor Substituído5" = Table.ReplaceValue(#"Tipo Alterado10",null,"",Replacer.ReplaceValue,{"GRAT_OBRA"}),
    #"Personalização Adicionada26" = Table.AddColumn(#"Valor Substituído5", "GRAT_OBRA_COR", each if [NAT_OBJETO] = 1 and Text.Length([GRAT_OBRA]) = 0 then "CORRIGIR" else if [NAT_OBJETO] = 2 and Text.Length([GRAT_OBRA]) > 0  then "CORRIGIR" else if Text.Length([GRAT_OBRA]) > 0 and [NAT_OBJETO] = 3 then "CORRIGIR" else if Text.Length([GRAT_OBRA]) > 0 and [NAT_OBJETO] = 4 then "CORRIGIR" else if Text.Length([GRAT_OBRA]) > 0 and [NAT_OBJETO] = 5 then "CORRIGIR" else "OK"),
    #"Valor Substituído7" = Table.ReplaceValue(#"Personalização Adicionada26",null,"",Replacer.ReplaceValue,{"OBS"}),
    #"Personalização Adicionada28" = Table.AddColumn(#"Valor Substituído7", "OBS_COR", each if Text.Length([OBS]) <= 0 and [CAT_OBJETO] = 1 then "CORRIGIR" else if Text.Length([OBS]) <= 0 and [CAT_OBJETO] = 40 then "CORRIGIR" else "OK"),
    #"Tipo Alterado5" = Table.TransformColumnTypes(#"Personalização Adicionada28",{{" VL_PAGO", type number}}),
    #"Arredondamento Inserido" = Table.AddColumn(#"Tipo Alterado5", "Arredondar", each Number.Round([#" VL_PAGO"], 2), type number),
    #"Tipo Alterado11" = Table.TransformColumnTypes(#"Arredondamento Inserido",{{" VL_CONTRATO ", type number}}),
    #"Multiplicação Inserida" = Table.AddColumn(#"Tipo Alterado11", "Multiplicação", each [#" VL_CONTRATO "] * 1, type number),
    #"Colunas Renomeadas" = Table.RenameColumns(#"Multiplicação Inserida",{{"Multiplicação", "VL_CONTRATO_NOVO"}, {"Arredondar", "VL_PAGO_NOVO"}}),
    #"Personalização Adicionada16" = Table.AddColumn(#"Colunas Renomeadas", "VALOR PAGO E VALOR CONTRATO", each if [VL_PAGO_NOVO] > [VL_CONTRATO_NOVO] then "VALOR PAGO MAIOR QUE VALOR DO CONTRATO - ACRESCENTAR COLUNA E JUSTIFICAR" else "OK"),
    #"Índice Adicionado" = Table.AddIndexColumn(#"Personalização Adicionada16", "Índice", 2, 1, Int64.Type),
    #"Colunas Reordenadas" = Table.ReorderColumns(#"Índice Adicionado",{"Índice", "ANO_EDITAL", "EDITAL", "CONTRATO", "COMPARTILHADA", "OBS_COMPARTILHADA", "DT_EDITAL", "PROCESSO", "MOD_LICITACAO", "REG_PRECOS", "NAT_OBJETO", "DESC_OBJETO", "CAT_OBJETO", "CRIT_JULGAMENTO", "DT_HOMOLOGACAO", "NOME_CONTRATADA", "CNPJ", "CPF", "DT_CONTRATO", " VL_CONTRATO ", " VL_PAGO", "VIGENCIA", "ADITIVO_PRECO", " VL_ADITIVO_PRECO", "ADITIVO_PRAZO", "VL_ADITIVO_PRAZO", "ADITIVO_OBJETO", " VL_REF_OBRA ", "FASE_OBRA", "EXEC_FISICA_OBRA", "GRAT_OBRA", "OBS", "ANO_EDITAL_COR", "EDITAL_COR", "COMPARTILHADA_COR", "DT_EDITAL_COR", "MOD_LICITACAO_COR", "REG_PRECOS_COR", "NAT_OBJETO_COR", "CAT_OBJETO_COR", "CRIT_JULGAMENTO_COR", "DT_HOMOLOGACAO_COR", "CNPJ_COR", "CPF_COR", "DT_CONTRATO_COR", "VL_CONTRATO_R$DEC_COR", "VL_PAGO_R$_COR", "ADITIVO_PRECO_COR", "VL_ADITIVO_PRECO_COR", "VL_ADITIVO_PRECO__R$DEC_COR", "ADITIVO_PRAZO_COR", "VL_ADITIVO_PRAZO_COR", "ADITIVO_OBJETO_COR", "VL_REF_OBRA_R$DEC_COR", "VL_REF_OBRA_R$_COR", "FASE_OBRA_COR", "EXEC_FISICA_OBRA_COR", "GRAT_OBRA_COR", "OBS_COR", "VL_PAGO_NOVO", "VL_CONTRATO_NOVO", "VALOR PAGO E VALOR CONTRATO"}),
    #"Colunas Renomeadas1" = Table.RenameColumns(#"Colunas Reordenadas",{{"VALOR PAGO E VALOR CONTRATO", "VALOR PAGO > VALOR CONTRATO"}})
in
    #"Colunas Renomeadas1"
